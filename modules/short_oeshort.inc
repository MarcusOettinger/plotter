<?php
//
// YAPlot: URL shortening via oeshort.de
// M. Oettinger 08/2015
// License: GPL
//

$useShortening = true;
// use QRcode that is generated by appending .qr to the end of the short link:
$useQR = true;

function getshortlink($longurl) {
	global $secret, $shorten;
	$debug = true;

	
	// Open phased url
	$ch = curl_init();
	$timeout = 5;
	curl_setopt($ch, CURLOPT_URL, $shorten . $longurl);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, $timeout);
	$yourlsoutput = curl_exec($ch);
	curl_close($ch);

	// Converts xml to php Array
	$xml = simplexml_load_string($yourlsoutput);
	if ($debug) {
		$str = print_r($xml, true);
		file_put_contents("oeshort.log", $str );
	}

	if ($xml->statusCode == 200) {
		$retval = $xml->shorturl;
	} else {
		$retval = "ERR ($xml->errorCode): $xml->message";
	}

	return $retval;
}
?>